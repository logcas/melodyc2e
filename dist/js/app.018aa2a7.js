(function(e){function t(t){for(var r,o,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&p.push(a[o][0]),a[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);u&&u(t);while(p.length)p.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==a[c]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={app:0},i=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="https://cdn.jsdelivr.net/gh/logcas/melodyc2e/dist/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var r=n("85ec"),a=n.n(r);a.a},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r,a,i=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("van-tabs",{attrs:{animated:"",sticky:""},model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},[n("van-tab",{attrs:{title:"曲库"}},[n("van-list",{attrs:{finished:e.finished,"finished-text":"没有更多了"},on:{load:e.onLoad},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},e._l(e.list,(function(t,r){return n("van-cell",{key:t._id,attrs:{"is-link":""},on:{click:function(n){return e.onChangeSong(t,r,"all")}}},[n("div",{staticClass:"cell-content",class:{playing:r===e.currentIndex&&"all"===e.currentType}},[n("span",{directives:[{name:"show",rawName:"v-show",value:r!==e.currentIndex,expression:"index !== currentIndex"}],staticClass:"seq"},[e._v(e._s(r+1))]),n("van-icon",{directives:[{name:"show",rawName:"v-show",value:r===e.currentIndex,expression:"index === currentIndex"}],staticStyle:{"margin-right":"5px"},attrs:{name:"play-circle-o"}}),e._v(" "+e._s(t.name)+" ")],1)])})),1)],1),n("van-tab",{attrs:{title:"设置"}},[n("van-cell",{attrs:{"is-link":"",title:"播放模式"},on:{click:function(t){e.showPlayModeSetting=!0}}})],1)],1),n("div",{staticClass:"player"},[n("audio",{ref:"player",staticStyle:{display:"none"},attrs:{type:"audio/mpeg"}}),n("div",{staticClass:"player-current"},[e._v(" "+e._s(e.loadingSource?"Loading...":e.currentSongName)+" ")]),n("div",{staticClass:"player-feat"},[n("div",{staticClass:"button second-button",on:{click:e.lastSong}},[n("van-icon",{attrs:{name:"arrow-left"}})],1),n("div",{staticClass:"button main-button"},[n("van-icon",{directives:[{name:"show",rawName:"v-show",value:!e.playing,expression:"!playing"}],attrs:{name:"play-circle-o"},on:{click:e.onPlay}}),n("van-icon",{directives:[{name:"show",rawName:"v-show",value:e.playing,expression:"playing"}],attrs:{name:"pause-circle-o"},on:{click:e.onPause}})],1),n("div",{staticClass:"button second-button",on:{click:e.nextSong}},[n("van-icon",{attrs:{name:"arrow"}})],1)]),n("div",{staticClass:"player-progress",style:{width:e.progress+"%"}})]),n("van-action-sheet",{attrs:{"cancel-text":"取消","close-on-click-action":"",actions:e.playModes},on:{select:e.onSelectPlayMode},model:{value:e.showPlayModeSetting,callback:function(t){e.showPlayModeSetting=t},expression:"showPlayModeSetting"}})],1)},s=[],c=(n("d81d"),n("a434"),n("b0c0"),n("d3b7"),n("5530")),l=n("2909"),u=(n("99af"),n("caad"),n("4ec9"),n("2532"),n("3ca3"),n("ddb0"),n("e7e5"),n("d399")),d=n("d4ec"),p=n("bee2"),h=n("ade3"),f={ALL:"all",LIKE:"like"},g={SEQ:"seq",RANDOM:"random"},y=(r={},Object(h["a"])(r,g.SEQ,(function(e,t){var n=t+1;return n=n<e?n:0,n})),Object(h["a"])(r,g.RANDOM,(function(e,t){function n(e){return Math.floor(Math.random()*e)}var r;while((r=n(e))===t);return r})),r),v=(a={},Object(h["a"])(a,g.SEQ,(function(e,t){var n=t-1;return n=n>=0?n:e-1,n})),Object(h["a"])(a,g.RANDOM,(function(e,t){function n(e){return Math.floor(Math.random()*e)}var r;while((r=n(e))===t);return r})),a),m=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(d["a"])(this,e),this.currentType=f.ALL,this.listTypes=[f.ALL,f.LIKE].concat(Object(l["a"])(t)),this.lists=new Map,this.currentIndex=0;var n=localStorage.getItem("playMode");n||(n=g.RANDOM),this.playMode=n,Object(u["a"])("当前模式：".concat(this.playMode===g.RANDOM?"随机播放":"顺序播放"))}return Object(p["a"])(e,[{key:"setMode",value:function(e){[g.RANDOM,g.SEQ].includes(e)&&(localStorage.setItem("playMode",e),this.playMode=e)}},{key:"_getOrDefault",value:function(e,t){return this.lists.has(e)||this.lists.set(e,t),this.lists.get(e)}},{key:"_getCurrentList",value:function(){return this.lists.get(this.currentType)}},{key:"addList",value:function(e,t){this.lists.set(e,t)}},{key:"getList",value:function(e){return this._getOrDefault(e,[])}},{key:"setCurrentSong",value:function(e,t){return t=t||this.currentType,this.currentIndex=e,this.setType(t,e),this.getCurrentSong()}},{key:"getCurrentSong",value:function(){var e=this._getCurrentList();return e[this.currentIndex]}},{key:"setType",value:function(e){if(!this.listTypes.includes(e))throw new Error("Invalid List Type");this.currentType=e}},{key:"nextSong",value:function(){var e=this._getCurrentList(),t=e.length,n=y[this.playMode](t,this.currentIndex);return this.currentIndex=n,e[n]}},{key:"lastSong",value:function(){var e=this._getCurrentList(),t=e.length,n=v[this.playMode](t,this.currentIndex);return this.currentIndex=n,e[n]}},{key:"getIndex",value:function(){return this.currentIndex}},{key:"storeInLocal",value:function(e){var t=this._getOrDefault(e,[]);localStorage.setItem(e,JSON.stringify(t))}},{key:"getFromLocal",value:function(e){try{var t=JSON.parse(localStorage.getItem(e));return t||[]}catch(n){return console.error(n),[]}}},{key:"mode",get:function(){return this.playMode}}]),e}(),b=new m,S={name:"App",data:function(){return{active:"2",list:[],loading:!1,finished:!1,page:0,q:"",currentIndex:-1,playing:!1,currentSongName:"选一首吧！",currentSongUrl:"",currentType:f.ALL,likeList:[],progress:0,progressTimer:null,loadingSource:!1,showPlayModeSetting:!1,playModes:[{name:"顺序播放",value:"seq"},{name:"随机播放",value:"random"}]}},watch:{currentSongUrl:function(e){var t=this.$refs.player;t.src=e,this.onReplay()},playing:function(e){e?this.progressTimer=setInterval(this.onPlayingProgress.bind(this),1e3):clearInterval(this.progressTimer)}},methods:{onPlayingProgress:function(){var e=this.$refs.player.duration,t=this.$refs.player.currentTime;this.progress=t/e*100,console.log(this.progress)},isMyLike:function(e){for(var t=e._id,n=-1,r=0;r<this.likeList.length;++r)if(this.likeList[r]._id===t){n=r;break}return-1!==n},onReplay:function(){this.$refs.player.pause(),this.$refs.player.play(),this.playing=!0},onPause:function(){this.$refs.player.pause(),this.playing=!1},onPlay:function(){this.$refs.player.play(),this.playing=!0},onLike:function(e,t){for(var n=-1,r=0;r<this.likeList.length;++r)if(this.likeList[r]._id===e._id){n=r;break}-1===n?this.likeList.push(e):this.likeList.splice(n,1),b.addList(f.LIKE,this.likeList),b.storeInLocal(f.LIKE),t.stopPropagation()},onChangeSong:function(e,t,n){console.log("change song");var r=b.setCurrentSong(t,n);console.log(r),this.currentSongName=r.name,this.currentSongUrl=r.url,this.currentIndex=t,this.currentType=n},onLoad:function(){var e=this;this.$api.getMelodies(this.page,this.q).then((function(t){var n;console.log(t),(n=e.list).push.apply(n,Object(l["a"])(t.list.map((function(e){return Object(c["a"])({},e,{name:decodeURIComponent(e.name)})})))),e.page++,e.finished=!t.has_more,b.addList(f.ALL,e.list)})).catch((function(){e.finished=!0})).finally((function(){e.loading=!1}))},nextSong:function(){var e=b.nextSong(),t=b.getIndex();console.log("next:",e),e&&(this.currentIndex=t,this.currentSongName=e.name,this.currentSongUrl=e.url)},lastSong:function(){var e=b.lastSong(),t=b.getIndex();console.log("next:",e),e&&(this.currentIndex=t,this.currentSongName=e.name,this.currentSongUrl=e.url)},onSelectPlayMode:function(e){var t=e.value;b.setMode(t),this.$notify({type:"success",message:"当前模式：".concat("seq"===t?"顺序播放":"随机播放")})}},created:function(){b.addList(f.ALL,this.list),this.likeList=b.getFromLocal(f.LIKE),b.addList(f.LIKE,this.likeList)},mounted:function(){var e=this,t=this.$refs.player;t.onended=function(){console.log("onend"),e.nextSong()},t.onloadstart=function(){console.log("loadStart"),e.loadingSource=!0},t.onerror=function(){console.log("error"),e.$toast.fail("连接失败，请检查网络")},t.oncanplay=function(){console.log("can play"),e.loadingSource=!1}}},L=S,k=(n("034f"),n("5c64"),n("2877")),x=Object(k["a"])(L,o,s,!1,null,null,null),w=x.exports,M=(n("5cfb"),n("bc3a")),I=n.n(M),O={development:"http://chameleon.logcas.name",production:"http://chameleon.logcas.name"},_=I.a.create({baseURL:O["production"],timeout:1e4});_.interceptors.response.use((function(e){return e.data.data}),(function(e){return e.response?u["a"].fail("服务器开小差啦，请稍后再试"):u["a"].fail("请检查网络"),e}));var P=_,j={getMelodies:function(e,t){return P.get("/melody",{params:{page:e,q:t}})}},C=n("fe3c"),T=n.n(C),N=(n("4160"),n("159b"),n("9a83"),n("f564")),$=(n("2cbd"),n("ab2c")),A=(n("0653"),n("34e9")),E=(n("5246"),n("6b41")),R=(n("c3a6"),n("ad06")),D=(n("c194"),n("7744")),q=(n("2994"),n("2bdd")),U=(n("bda7"),n("5e46")),K=(n("da3c"),n("0b33"));function J(e){var t=[K["a"],U["a"],q["a"],D["a"],R["a"],E["a"],A["a"],$["a"],N["a"]];t.forEach((function(t){return e.use(t)}))}J(i["a"]),T.a.attach(document.body),i["a"].config.productionTip=!1,i["a"].prototype.$api=j,new i["a"]({render:function(e){return e(w)}}).$mount("#app")},"5c64":function(e,t,n){"use strict";var r=n("d32a"),a=n.n(r);a.a},"85ec":function(e,t,n){},d32a:function(e,t,n){}});
//# sourceMappingURL=app.018aa2a7.js.map